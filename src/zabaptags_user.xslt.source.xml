<?sap.transform simple?>
<tt:transform
  xmlns:tt="http://www.sap.com/transformation-templates"
  xmlns:ddic="http://www.sap.com/abapxml/types/dictionary"
  xmlns:adtbase="http://www.devepos.com/adt/base">

  <tt:root name="USER" type="ddic:ZABAPTAGS_USER"/>

  <tt:template>
    <tt:apply name="user">
      <tt:with-root name="USER" ref="USER"/>
    </tt:apply>
  </tt:template>

  <!-- PUBLIC TEMPLATES (can be called from other transformations) -->
  <tt:template name="user">
    <tt:context>
      <tt:root name="USER"/>
    </tt:context>

    <adtbase:user tt:extensible="deep">
      <tt:apply name="userAttributes">
        <tt:with-root name="USER" ref="USER"/>
      </tt:apply>
    </adtbase:user>
  </tt:template>

  <!-- PUBLIC TEMPLATES (can be called from other transformations) -->
  <tt:template name="userAttributes">
    <tt:context>
      <tt:root name="USER"/>
    </tt:context>

    <tt:cond check="not-initial(USER.NAME)">
      <tt:attribute name="adtbase:name" value-ref="USER.NAME"/>
    </tt:cond>

  </tt:template>

  <tt:template name="users">
    <tt:context>
      <tt:root name="USERS" type="ddic:ZABAPTAGS_USER_T"/>
    </tt:context>
    <tt:cond check="not-initial(USERS)">
      <tt:loop ref="USERS">
        <tt:apply name="user">
          <tt:with-root name="USER" ref="$ref"/>
        </tt:apply>
      </tt:loop>
    </tt:cond>
  </tt:template>

</tt:transform>
